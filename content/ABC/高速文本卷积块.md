# 题目：高速文本卷积块（Depthwise Separable Conv1d）

**目标**：实现一维深度可分离卷积（先逐通道 depthwise，再 pointwise），常用于轻量 NLP CNN。

## 数学定义

输入 $X \in \mathbb{R}^{B \times C \times L}$。

深度卷积（每个通道独立）：

$$
Y_{c,\ell} = \sum_{k=0}^{K-1} W^{(d)}_{c,k}\, X_{c,\ell+k-p}
$$

逐点卷积：

$$
Z_{c',\ell} = \sum_{c=1}^{C} W^{(p)}_{c',c}\, Y_{c,\ell}
$$

## 实现要求

- 使用 `groups=C` 实现 depthwise，再接 `1x1` 的 pointwise。
- 支持 `padding='same'` 效果（手动计算 padding）。

## 参考实现

```python
import torch
import torch.nn as nn

class DepthwiseSeparableConv1d(nn.Module):
    def __init__(self, in_ch, out_ch, kernel_size, dilation=1):
        super().__init__()
        self.pad = (kernel_size - 1) // 2 * dilation
        self.depthwise = nn.Conv1d(in_ch, in_ch, kernel_size,
                                   groups=in_ch, dilation=dilation, padding=self.pad)
        self.pointwise = nn.Conv1d(in_ch, out_ch, kernel_size=1)

    def forward(self, x):  # x: (B,C,L)
        y = self.depthwise(x)
        z = self.pointwise(y)
        return z

# 验证形状
x = torch.randn(2, 64, 100)
m = DepthwiseSeparableConv1d(64, 128, kernel_size=5, dilation=1)
out = m(x)
print(out.shape)  # (2,128,100)
```

```

```
